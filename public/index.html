<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>MiniTube</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 10px;
      background: #f9f9f9;
    }
    h2 {
      text-align: center;
    }
    button {
      padding: 8px 12px;
      margin: 5px;
      font-size: 16px;
    }
    video {
      max-width: 100%;
      border-radius: 8px;
    }
    .video-box {
      background: #fff;
      padding: 10px;
      margin-bottom: 15px;
      border-radius: 8px;
    }
  </style>
</head>
<body>

<h2>MiniTube</h2>

<!-- –ö–Ω–æ–ø–∫–∏ -->
<div style="text-align:center;">
  <button onclick="showHome()">üè† –ì–ª–∞–≤–Ω–∞—è</button>
  <button onclick="showUpload()">‚ûï</button>
</div>

<hr>

<!-- –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ -->
<div id="upload" style="display:none; text-align:center;">
  <input type="file" id="file" accept="video/*"><br><br>
  <button onclick="upload()">–í—ã–ª–æ–∂–∏—Ç—å –≤–∏–¥–µ–æ</button>
</div>

<!-- –õ–µ–Ω—Ç–∞ -->
<div id="videos"></div>

<script>
function showUpload() {
  document.getElementById("upload").style.display = "block";
}

function showHome() {
  document.getElementById("upload").style.display = "none";
  loadVideos();
}

function upload() {
  const file = document.getElementById("file").files[0];
  if (!file) {
    alert("–í—ã–±–µ—Ä–∏ –≤–∏–¥–µ–æ");
    return;
  }

  const fd = new FormData();
  fd.append("video", file);

  fetch("/upload", {
    method: "POST",
    body: fd
  }).then(() => {
    alert("–í–∏–¥–µ–æ –≤—ã–ª–æ–∂–µ–Ω–æ");
    document.getElementById("file").value = "";
    loadVideos();
  });
}

function like(id) {
  fetch("/like/" + id, { method: "POST" })
    .then(loadVideos);
}

function comment(id) {
  const input = document.getElementById("c" + id);
  const text = input.value;
  if (!text) return;

  fetch("/comment/" + id, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ text })
  }).then(() => {
    input.value = "";
    loadVideos();
  });
}

function loadVideos() {
  fetch("/videos")
    .then(r => r.json())
    .then(list => {
      const v = document.getElementById("videos");
      v.innerHTML = "";
      list.slice().reverse().forEach(video => {
        v.innerHTML += `
          <div class="video-box">
            <video src="/uploads/${video.file}" controls></video><br><br>
            ‚ù§Ô∏è ${video.likes}
            <button onclick="like(${video.id})">–õ–∞–π–∫</button><br><br>
            <input id="c${video.id}" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π">
            <button onclick="comment(${video.id})">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
          </div>
        `;
      });
    });
}

loadVideos();
</script>

</body>
</html>
